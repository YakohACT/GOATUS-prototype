/* ãƒ†ã‚­ãƒˆã‚¦ã‚‚ä½œæˆã—ãŸã‚„ã¤ãƒ€ãƒ¨ãƒ¼ */

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>My SNS</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: #4267B2;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 24px;
    }
    header button {
      background: #365899;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    header button:hover {
      background: #2e4470;
    }
    main {
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
    }
    .post {
      border-bottom: 1px solid #ddd;
      padding: 10px;
      position: relative;
    }
    .post:last-child {
      border-bottom: none;
    }
    .post-author {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .post-text {
      margin-bottom: 35px; /* å‰Šé™¤ãƒœã‚¿ãƒ³ã¨è·é›¢ã‚’ç¢ºä¿ */
    }
    .new-post {
      display: flex;
      margin-bottom: 20px;
    }
    .new-post input {
      flex: 1;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin-right: 10px;
    }
    .new-post button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      background: #4267B2;
      color: white;
      cursor: pointer;
    }
    .new-post button:hover {
      background: #365899;
    }
    .like-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 18px;
      color: #888;
      user-select: none;
    }
    .like-btn.liked {
      color: red;
      cursor: default;
    }
    .delete-btn {
      position: absolute;
      bottom: 10px;      /* æœ¬æ–‡ã¨è·é›¢ç¢ºä¿ */
      left: 10px;
      cursor: pointer;
      font-size: 14px;
      color: #888;
      background: #f9f9f9;
      padding: 2px 5px;
      border-radius: 4px;
    }
    .delete-btn:hover {
      color: #f00;
    }
    .like-count {
      font-size: 14px;
      color: #555;
      margin-left: 5px;
    }
  </style>
</head>
<body>

<header>
  My SNS
  <button onclick="changeUsername()">âš™ï¸ è¨­å®š</button>
</header>

<main>
  <div class="new-post">
    <input type="text" id="postInput" placeholder="ä½•ã‹æŠ•ç¨¿ã—ã¦ã¿ã‚ˆã†â€¦">
    <button onclick="addPost()">æŠ•ç¨¿</button>
  </div>
  <div id="posts"></div>
</main>

<script>
  let username = localStorage.getItem('snsUsername') || 'åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼';
  let likedPosts = JSON.parse(localStorage.getItem('likedPosts') || '[]'); // ã„ã„ã­æ¸ˆã¿æŠ•ç¨¿ID

  window.onload = function() {
    const savedPosts = JSON.parse(localStorage.getItem('snsPosts') || '[]');
    savedPosts.forEach(post => renderPost(post));
  };

  function addPost() {
    const input = document.getElementById('postInput');
    const text = input.value.trim();
    if (!text) return;

    const post = {
      id: Date.now(),
      author: username,
      text: text,
      timestamp: new Date().toISOString(),
      likes: 0
    };

    const savedPosts = JSON.parse(localStorage.getItem('snsPosts') || '[]');
    savedPosts.unshift(post);
    localStorage.setItem('snsPosts', JSON.stringify(savedPosts));

    renderPost(post, true);
    input.value = '';
  }

  function renderPost(post, prepend = false) {
    const postsDiv = document.getElementById('posts');

    const postDiv = document.createElement('div');
    postDiv.className = 'post';
    postDiv.setAttribute('data-id', post.id);

    const authorDiv = document.createElement('div');
    authorDiv.className = 'post-author';
    authorDiv.textContent = post.author;

    const textDiv = document.createElement('div');
    textDiv.className = 'post-text';
    textDiv.textContent = post.text;

    // ã„ã„ã­ãƒœã‚¿ãƒ³
    const likeBtn = document.createElement('span');
    likeBtn.className = 'like-btn';
    likeBtn.innerHTML = 'â¤ï¸';
    const likeCount = document.createElement('span');
    likeCount.className = 'like-count';
    likeCount.textContent = post.likes;
    likeBtn.appendChild(likeCount);

    if (likedPosts.includes(post.id)) {
      likeBtn.classList.add('liked');
    } else {
      likeBtn.onclick = () => toggleLike(post.id, likeBtn, likeCount);
    }

    // å‰Šé™¤ãƒœã‚¿ãƒ³
    const deleteBtn = document.createElement('span');
    deleteBtn.className = 'delete-btn';
    deleteBtn.textContent = 'ğŸ—‘ï¸ å‰Šé™¤';
    deleteBtn.onclick = () => deletePost(post.id, postDiv);

    postDiv.appendChild(authorDiv);
    postDiv.appendChild(textDiv);
    postDiv.appendChild(likeBtn);
    postDiv.appendChild(deleteBtn);

    if (prepend) {
      postsDiv.insertBefore(postDiv, postsDiv.firstChild);
    } else {
      postsDiv.appendChild(postDiv);
    }
  }

  function toggleLike(id, likeBtn, likeCount) {
    if (likedPosts.includes(id)) return; // ã™ã§ã«ã„ã„ã­æ¸ˆã¿ãªã‚‰ä½•ã‚‚ã—ãªã„

    const savedPosts = JSON.parse(localStorage.getItem('snsPosts') || '[]');
    const post = savedPosts.find(p => p.id === id);
    if (!post) return;

    post.likes += 1;
    localStorage.setItem('snsPosts', JSON.stringify(savedPosts));

    likeCount.textContent = post.likes;
    likeBtn.classList.add('liked');

    likedPosts.push(id);
    localStorage.setItem('likedPosts', JSON.stringify(likedPosts));
  }

  function deletePost(id, postDiv) {
    let savedPosts = JSON.parse(localStorage.getItem('snsPosts') || '[]');
    savedPosts = savedPosts.filter(p => p.id !== id);
    localStorage.setItem('snsPosts', JSON.stringify(savedPosts));

    // å‰Šé™¤ã•ã‚ŒãŸæŠ•ç¨¿ãŒ likedPosts ã«ã‚ã‚Œã°é™¤å¤–
    likedPosts = likedPosts.filter(likeId => likeId !== id);
    localStorage.setItem('likedPosts', JSON.stringify(likedPosts));

    postDiv.remove();
  }

  function changeUsername() {
    const newName = prompt('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', username);
    if (newName && newName.trim() !== '') {
      username = newName.trim();
      localStorage.setItem('snsUsername', username);
      alert('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’ ' + username + ' ã«å¤‰æ›´ã—ã¾ã—ãŸ');
    }
  }
</script>

</body>
</html>
